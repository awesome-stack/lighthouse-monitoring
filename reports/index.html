<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>View</title>
  <!-- https://datatables.net/manual/ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.semanticui.min.css" />
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.semanticui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>
  <!-- https://datatables.net/extensions/fixedheader/ -->
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.1.5/css/fixedHeader.semanticui.min.css">
  <script src="https://cdn.datatables.net/fixedheader/3.1.5/js/fixedHeader.semanticui.min.js"></script>
  <!-- https://c3js.org/examples.html -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.min.js"></script>
  <style>
    .chart {
      float: left;
      width: 100%;
      height: 300px;
      font-weight: bold;
      border: solid 1px gray;
      margin: auto;
    }
  </style>
</head>

<body>
  <table id="latestTable" class="ui celled table" style="width:100%">
    <thead>
      <tr>
        <th>Name</th>
        <th>URL</th>
        <th>Performance</th>
        <th>PWA</th>
        <th>Accessibility</th>
        <th>Best Practices</th>
        <th>SEO</th>
        <th>Latest FetchTime</th>
      </tr>
    </thead>
  </table>
  <div id="graphArea">
    <h2 id="graphTitle">Graph</h2>
    <div id="performance" class="chart"></div>
    <div id="pwa" class="chart"></div>
    <div id="accessibility" class="chart"></div>
    <div id="best-practices" class="chart"></div>
    <div id="seo" class="chart"></div>
    <div id="first-contentful-paint" class="chart"></div>
    <div id="first-meaningful-paint" class="chart"></div>
    <div id="speed-index" class="chart"></div>
    <div id="first-cpu-idle" class="chart"></div>
    <div id="time-to-interactive" class="chart"></div>
    <div id="estimated-input-latency" class="chart"></div>
    <div id="time-to-first-byte" class="chart"></div>
  </div>
  <script>
    function chartFromJson(jsonUrl, keyId, axisY) {
      var keyList = [];
      keyList.push(keyId);
      return c3.generate({
        title: {
          show: true,
          text: keyId,
          position: 'top-center',
          padding: {
            top: 20,
            right: 20,
            bottom: 40,
            left: 50
          }
        },
        legend: {
          show: false,
          // position: 'inset',
          // inset: {
          //   anchor: 'top-left', // top-left, top-center and top-right
          //   x: 20,
          //   y: 0,
          //   step: 1
          // },
        },
        bindto: '#' + keyId,
        data: {
          url: jsonUrl,
          mimeType: 'json',
          keys: {
            x: 'datetime',
            value: keyList,
          },
          type: 'spline'
        },
        axis: {
          x: {
            type: 'category',
            multiline: true,
            height: 77,
            padding: {
              left: 0,
              right: 0
            }
          },
          y: Object.assign({
            padding: { top: 0, bottom: 0 }
          }, axisY)
        }
      });
    }

    function onSelectTarget(name, jsonUrl) {
      $('#graphArea').show();
      $('#graphTitle').text(name);
      // Score
      chartFromJson(jsonUrl, 'performance', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'pwa', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'accessibility', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'best-practices', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'seo', { max: 100, min: 0 });
      // Detail
      chartFromJson(jsonUrl, 'first-contentful-paint', { min: 0 });
      chartFromJson(jsonUrl, 'first-meaningful-paint', { min: 0 });
      chartFromJson(jsonUrl, 'speed-index', { min: 0 });
      chartFromJson(jsonUrl, 'first-cpu-idle', { min: 0 });
      chartFromJson(jsonUrl, 'time-to-interactive', { min: 0 });
      chartFromJson(jsonUrl, 'estimated-input-latency', { min: 0 });
      chartFromJson(jsonUrl, 'time-to-first-byte', { min: 0 });
    }

    $(function () {
      $.extend($.fn.dataTable.defaults, {
        // language: { url: "http://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Japanese.json" }
      });
      $("#latestTable").DataTable({
        fixedHeader: true,
        ajax: { url: "./latest.json", dataSrc: '' },
        columns: [
          {
            data: "name",
            render: function (data, type, row, meta) {
              if (type === 'display') {
                data = '<a href="javascript:void(0);" onclick="onSelectTarget(\'' + data + '\',\'' + row.path + '\');">' + data + '</a>'
              }
              return data;
            }
          },
          {
            data: "url",
            render: function (data, type, row, meta) {
              if (type === 'display') {
                data = '<a href="' + row.url + '">' + data + '</a>';
              }
              return data;
            }
          },
          { data: "performance" },
          { data: "pwa" },
          { data: "accessibility" },
          { data: "best-practices" },
          { data: "seo" },
          { data: "datetime" }
        ]
      });
      $('#graphArea').hide();
    });
  </script>

</body>

</html>
