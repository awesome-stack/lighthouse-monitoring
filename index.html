<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>View</title>
  <!-- https://datatables.net/manual/ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.semanticui.min.css" />
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.semanticui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>
  <!-- https://c3js.org/examples.html -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.min.js"></script>
  <style>
    .chart.large {
      float: left;
      width: 100%;
      height: 200px;
    }

    .chart.mini {
      float: left;
      width: 50%;
      height: 200px;
    }
  </style>
</head>

<body>
  <table id="latestTable" class="ui celled table" style="width:100%">
    <thead>
      <tr>
        <th>Name</th>
        <th>URL</th>
        <th>Performance</th>
        <th>PWA</th>
        <th>Accessibility</th>
        <th>Best Practices</th>
        <th>SEO</th>
      </tr>
    </thead>
  </table>
  <div id="performance" class="chart large"></div>
  <div id="pwa" class="chart mini"></div>
  <div id="accessibility" class="chart mini"></div>
  <div id="best-practices" class="chart mini"></div>
  <div id="seo" class="chart mini"></div>
  <script>
    function chartFromJson(jsonUrl, keyId) {
      var keyList = [];
      keyList.push(keyId);
      return c3.generate({
        bindto: '#' + keyId,
        data: {
          url: jsonUrl,
          mimeType: 'json',
          keys: {
            x: 'datetime',
            value: keyList,
          },
          type: 'spline'
        },
        axis: {
          x: {
            type: 'category'
          }
        }
      });
    }

    function reloadChart(jsonUrl) {
      chartFromJson(jsonUrl, 'performance');
      chartFromJson(jsonUrl, 'pwa');
      chartFromJson(jsonUrl, 'accessibility');
      chartFromJson(jsonUrl, 'best-practices');
      chartFromJson(jsonUrl, 'seo');
    }

    $(function () {
      $.extend($.fn.dataTable.defaults, {
        language: {
          url: "http://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Japanese.json"
        }
      });
      $("#latestTable").DataTable({
        ajax: { url: "reports/latest.json", dataSrc: '' },
        columns: [
          {
            data: "name",
            render: function (data, type, row, meta) {
              if (type === 'display') {
                console.log(row.path);
                data = '<a href="javascript:void(0);" onclick="reloadChart(\'' + row.path + '\');">' + data + '</a>'
              }
              return data;
            }
          },
          {
            data: "url",
            render: function (data, type, row, meta) {
              if (type === 'display') {
                data = '<a href="' + row.name + '">' + data + '</a>';
              }
              return data;
            }
          },
          { data: "performance" },
          { data: "pwa" },
          { data: "accessibility" },
          { data: "best-practices" },
          { data: "seo" }
        ]
      });
    });
  </script>

</body>

</html>
