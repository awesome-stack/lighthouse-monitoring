<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>View</title>
  <!-- https://datatables.net/manual/ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.semanticui.min.css" />
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.semanticui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>
  <!-- https://c3js.org/examples.html -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.7/c3.min.js"></script>
  <style>
    .chart.large {
      float: left;
      width: 100%;
      height: 200px;
    }

    .chart.mini {
      float: left;
      width: 50%;
      height: 200px;
    }
  </style>
</head>

<body>
  <table id="latestTable" class="ui celled table" style="width:100%">
    <thead>
      <tr>
        <th>Name</th>
        <th>URL</th>
        <th>Performance</th>
        <th>PWA</th>
        <th>Accessibility</th>
        <th>Best Practices</th>
        <th>SEO</th>
        <th>Latest FetchTime</th>
      </tr>
    </thead>
  </table>
  <div id="performance" class="chart large"></div>
  <div id="pwa" class="chart mini"></div>
  <div id="accessibility" class="chart mini"></div>
  <div id="best-practices" class="chart mini"></div>
  <div id="seo" class="chart mini"></div>
  <div id="first-contentful-paint" class="chart mini"></div>
  <div id="first-meaningful-paint" class="chart mini"></div>
  <div id="speed-index" class="chart mini"></div>
  <div id="first-cpu-idle" class="chart mini"></div>
  <div id="time-to-interactive" class="chart mini"></div>
  <div id="estimated-input-latency" class="chart mini"></div>
  <script>
    function chartFromJson(jsonUrl, keyId, axisY) {
      var keyList = [];
      keyList.push(keyId);
      return c3.generate({
        bindto: '#' + keyId,
        data: {
          url: jsonUrl,
          mimeType: 'json',
          keys: {
            x: 'datetime',
            value: keyList,
          },
          type: 'spline'
        },
        axis: {
          x: {
            type: 'category'
          },
          y: Object.assign({
            padding: { top: 0, bottom: 0 }
          }, axisY)
        }
      });
    }

    function reloadChart(jsonUrl) {
      // Score
      chartFromJson(jsonUrl, 'performance', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'pwa', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'accessibility', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'best-practices', { max: 100, min: 0 });
      chartFromJson(jsonUrl, 'seo', { max: 100, min: 0 });
      // Detail
      chartFromJson(jsonUrl, 'first-contentful-paint', { min: 0 });
      chartFromJson(jsonUrl, 'first-meaningful-paint', { min: 0 });
      chartFromJson(jsonUrl, 'speed-index', { min: 0 });
      chartFromJson(jsonUrl, 'first-cpu-idle', { min: 0 });
      chartFromJson(jsonUrl, 'time-to-interactive', { min: 0 });
      chartFromJson(jsonUrl, 'estimated-input-latency', { min: 0 });
    }

    $(function () {
      $.extend($.fn.dataTable.defaults, {
        // language: { url: "http://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Japanese.json" }
      });
      $("#latestTable").DataTable({
        ajax: { url: "./latest.json", dataSrc: '' },
        columns: [
          {
            data: "name",
            render: function (data, type, row, meta) {
              if (type === 'display') {
                console.log(row.path);
                data = '<a href="javascript:void(0);" onclick="reloadChart(\'' + row.path + '\');">' + data + '</a>'
              }
              return data;
            }
          },
          {
            data: "url",
            render: function (data, type, row, meta) {
              if (type === 'display') {
                data = '<a href="' + row.url + '">' + data + '</a>';
              }
              return data;
            }
          },
          { data: "performance" },
          { data: "pwa" },
          { data: "accessibility" },
          { data: "best-practices" },
          { data: "seo" },
          { data: "datetime" }
        ]
      });
    });
  </script>

</body>

</html>
